!function(){"use strict";function t(t){for(var e,i,n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,null);e=n.nextNode();)if(3===e.nodeType&&-1!==e.textContent.indexOf(l)){i=e;break}return i}function e(e,i){var n=window.getSelection();if(0!==n.rangeCount){var s=n.getRangeAt(0);if(s.collapsed&&document.activeElement===e){var r=document.createTextNode(l);s.insertNode(r),i(),e.innerHTML=e.innerHTML;var o=t(e);if(o){var h=document.createRange();if(1===e.childNodes.length&&e.textContent===l&&e.childNodes[0]===o)o.parentNode.removeChild(o),h.setStart(e,0);else{var a=o.textContent.indexOf(l);o.textContent=o.textContent.replace(c,""),h.setStart(o,a)}n.removeAllRanges(),n.addRange(h)}}}}function i(t,e,i){var n,s,r=null,o=[],h=new RegExp("\\s|<|\\"+i.join("|\\"));for(n=0;n<e.length;n++)s=e[n],null!==r&&s.match(h)&&(o.push({start:r,stop:n}),r=null),null===r&&s===t&&(r=n);null!==r&&o.push({start:r,stop:e.length});var a=[];for(n=0;n<o.length;n++)s=o[n],e[s.stop-1]===l&&(s.stop-=1),s.start+1!==s.stop&&a.push(s);return a}function n(){var t=this.$element.html();t=t.replace(/<\/?span[^>]*>/gi,"");var e,n,s,r;for(e=0;e<this.trigger.length;e++)for(r=i(this.trigger[e],t,this.trigger),n=r.length-1;n>=0;n--)s=r[n],t=t.substring(0,s.start)+'<span class="tag tag'+(e+1)+'">'+t.substring(s.start,s.stop)+"</span>"+t.substring(s.stop);this.$element.html(t)}function s(t){return t.replace(l,"")}function r(){var t=this.$element.html();""===t&&this.$element.html("<br>")}function o(t){var i,n=this,s=this.action;if(90===t.which&&(t.metaKey||t.ctrlKey)&&t.preventDefault(),9!==t.which){var o=this.$element.html();e(n.$element[0],function(){i=n.$element.html()}),setTimeout(function(){var h=n.$element.html();i=i||o,e(n.$element[0],function(){if(90===t.which&&(t.metaKey||t.ctrlKey))t.shiftKey?(n.history.revertsPos>-1&&n.history.push(i),n.$element.html(n.history.revert())):(n.$element.html(n.history.prev()),n.history.keep(i),n.action="back");else{switch(t.which){case 8:n.action="del";break;case 86:(t.metaKey||t.ctrlKey)&&(n.action="paste"+(new Date).getTime());break;case 37:case 38:case 39:case 40:n.action="arrow";break;default:o!==h&&(n.action="none")}o!==h&&s!==n.action&&(n.history.push(i),n.history.clearReverts()),"arrow"===n.action&&n.history.update(n.$element.html())}n.callback()}),r.call(n)},0)}}function h(){this.history.update(l+this.$element.html())}function a(){var t=this;e(this.$element[0],function(){t.history.update(t.$element.html())})}var l="â˜ƒ",c=new RegExp(l,"ig"),p=function(t){this.entries=[t||""],this.reverts=[],this.position=0,this.revertsPos=-1};p.prototype.update=function(t){0===this.position&&s(this.entries[0])===s(t)&&(this.entries[0]=t)},p.prototype.push=function(t){s(t)!==s(this.entries[this.position])&&(this.entries.push(t),this.position+=1)},p.prototype.prev=function(){var t=this.entries[this.position];return this.position>0&&(this.position-=1),this.entries.length=this.position+1,t},p.prototype.keep=function(t){s(t)!==s(this.entries[0])&&s(t)!==s(this.entries[this.position])&&(this.reverts.push(t),this.revertsPos+=1)},p.prototype.revert=function(){var t=this.reverts[this.revertsPos];return this.revertsPos>-1&&(this.revertsPos-=1),this.reverts.length=this.revertsPos+1,t},p.prototype.clearReverts=function(){this.reverts.length=0,this.revertsPos=-1};var u=function(t,e){this.$element=$(t),this.setTrigger(e),r.call(this),this.callback(),this.history=new p(l+this.$element.html()),this.action="none",this.$element.on("keydown",$.proxy(o,this)).on("focus",$.proxy(h,this)).on("click",$.proxy(a,this))};u.prototype.setTrigger=function(t){"function"==typeof t?this.callback=$.proxy(t,this.$element[0]):(this.callback=$.proxy(n,this),t&&(this.trigger=$.isArray(t)?t:t.split("")))},$.retype=e,$.retype.CARET_CHAR=l,$.fn.retype=function(t){return this.each(function(){var e=$(this),i=e.data("retype.instance");i?i.setTrigger(t):e.data("retype.instance",i=new u(this,t))})}}(jQuery);